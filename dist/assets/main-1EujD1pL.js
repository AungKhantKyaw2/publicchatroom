import{g as _,d as X,a as q,b as L,o as O,q as E,c as Y,w as $,T as A,e as H}from"./main-Bt7vG7o_.js";import{t as d,n as b,g as w,a as R,e as F,m as v,b as M}from"./uielement-B0N8UykG.js";/* empty css                */function N(e,t){const n=async o=>{const l=new Date,u={username:curuser,room:curroom,message:o,created_at:A.fromDate(l)};try{return await H(dbRef,u)}catch(f){console.log("Error addchat = ",f)}},r=o=>{unscribe&&unscribe(),unscribe=O(E(dbRef,$("room","==",curroom),Y("created_at")),l=>{l.docChanges().forEach(u=>{console.log(u),u.type==="added"&&o(u.doc.data())})})},s=o=>{curroom=o,console.log(`Room changed to ${curroom}`)},c=o=>{curuser=o,localStorage.setItem("username",curuser),console.log(localStorage),console.log(`Username Changed to ${curuser}`)};return(()=>{deleteiner=setInterval(async()=>{try{const o=await _(dbRef);if(console.log(o),o.empty){console.log("No message to delete"),clearInterval(deleteiner);return}o.forEach(async l=>{await X(q(L,"chats",l.id))}),console.log("All message delete successfully")}catch(o){console.error("Error deleting message :",o)}},15e3)})(),{addChat:n,getChats:r,updateChatroom:s,updateUsername:c}}function y(e,t){const n=+d(e)-+d(t);return n<0?-1:n>0?1:n}function U(e,t,n){const[r,s]=b(n?.in,e,t),c=r.getFullYear()-s.getFullYear(),i=r.getMonth()-s.getMonth();return c*12+i}function z(e){return t=>{const r=(e?Math[e]:Math.trunc)(t);return r===0?0:r}}function j(e,t){return+d(e)-+d(t)}function k(e,t){const n=d(e,t?.in);return n.setHours(23,59,59,999),n}function G(e,t){const n=d(e,t?.in),r=n.getMonth();return n.setFullYear(n.getFullYear(),r+1,0),n.setHours(23,59,59,999),n}function B(e,t){const n=d(e,t?.in);return+k(n,t)==+G(n,t)}function J(e,t,n){const[r,s,c]=b(n?.in,e,e,t),i=y(s,c),o=Math.abs(U(s,c));if(o<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-i*o);let l=y(s,c)===-i;B(r)&&o===1&&y(r,c)===1&&(l=!1);const u=i*(o-+l);return u===0?0:u}function K(e,t,n){const r=j(e,t)/1e3;return z(n?.roundingMethod)(r)}function P(e,t,n){const r=R(),s=n?.locale??r.locale??F,c=2520,i=y(e,t);if(isNaN(i))throw new RangeError("Invalid time value");const o=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:i}),[l,u]=b(n?.in,...i>0?[t,e]:[e,t]),f=K(u,l),C=(w(u)-w(l))/1e3,a=Math.round((f-C)/60);let h;if(a<2)return n?.includeSeconds?f<5?s.formatDistance("lessThanXSeconds",5,o):f<10?s.formatDistance("lessThanXSeconds",10,o):f<20?s.formatDistance("lessThanXSeconds",20,o):f<40?s.formatDistance("halfAMinute",0,o):f<60?s.formatDistance("lessThanXMinutes",1,o):s.formatDistance("xMinutes",1,o):a===0?s.formatDistance("lessThanXMinutes",1,o):s.formatDistance("xMinutes",a,o);if(a<45)return s.formatDistance("xMinutes",a,o);if(a<90)return s.formatDistance("aboutXHours",1,o);if(a<v){const m=Math.round(a/60);return s.formatDistance("aboutXHours",m,o)}else{if(a<c)return s.formatDistance("xDays",1,o);if(a<M){const m=Math.round(a/v);return s.formatDistance("xDays",m,o)}else if(a<M*2)return h=Math.round(a/M),s.formatDistance("aboutXMonths",h,o)}if(h=J(u,l),h<12){const m=Math.round(a/M);return s.formatDistance("xMonths",m,o)}else{const m=h%12,p=Math.trunc(h/12);return m<3?s.formatDistance("aboutXYears",p,o):m<9?s.formatDistance("overXYears",p,o):s.formatDistance("almostXYears",p+1,o)}}function Q(e){const t=r=>{const s=P(r.created_at.toDate(),new Date,{addSuffix:!0}),c=`    <li class="shadow rounded-lg px-4 py-2">
                                <div class="flex justify-between">
                                     <h5 class="text-gray-600 font-medium text-sm">${r.username}/h5>
                                     <i class="text-gray-300 text-xs">${s}</i>
                                </div>
                                <p class="text-gray-600 text-sm">${r.message}</p>
                            </li>`;e.innerHTML+=c};function n(){e.innerHTML=""}return{newli:t,clearli:n}}const V=document.querySelector(".chatrooms"),W=document.querySelector(".chat-ul"),x=document.querySelector(".chat-form"),g=document.querySelector(".user-form"),I=document.querySelector(".msg"),T=document.querySelector(".roomtitle"),Z=localStorage.getItem("username")?localStorage.getItem("username"):"Guest";g.username.placeholder=`username is ${Z}`;const D=N();T.textContent="General";const S=Q(W);console.log(S);x.addEventListener("submit",e=>{e.preventDefault();const t=x.message.value.trim();D.addChat(t).then(()=>x.reset()).catch(n=>console.log(n))});g.addEventListener("submit",e=>{e.preventDefault();const t=g.username.value.trim();D.updateUsername(t),g.reset(),I.innerText=`New name updated to ${t}`,g.username.placeholder=`username is ${t}`,setTimeout(()=>I.innerText="",3e3)});V.addEventListener("click",e=>{e.preventDefault();const t=e.target.closest("button");if(console.log(t),t){const n=t.getAttribute("id");console.log(n);const r=t.querySelector("h3").innerText;T.textContent=r,S.clearli(),D.updateChatroom(n),D.getChats(s=>{console.log(s),S.newli(s)})}});D.getChats(e=>{console.log(e),S.newli(e)});
